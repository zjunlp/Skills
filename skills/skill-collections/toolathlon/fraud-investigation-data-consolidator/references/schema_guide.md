# Schema Reference: transactions_analytics Dataset

This guide documents the key tables and relationships used by the `fraud-investigation-data-consolidator` skill.

## Core Transaction Tables

### `live_transactions`
The primary fact table. Contains the main transaction record with risk scores and analysis metadata.
*   **Primary Key:** `transaction_id`
*   **Foreign Keys:**
    *   `user_id` → `users.user_id`
    *   `account_id` → `accounts.account_id`
    *   `merchant_id` → `merchants.merchant_id`
    *   `card_id` → `cards.card_id`
    *   `device_id` → `devices.device_id`
    *   `location_id` → `locations.location_id`
*   **Notable Fields:**
    *   `amount`, `currency`, `timestamp`, `status`
    *   `risk_score`, `ml_fraud_score`
    *   `flags`: **JSON string** array of triggered rule flags.
    *   `velocity_checks`, `geographic_data`, `device_analysis`, `merchant_analysis`, `network_analysis`: **JSON string** objects containing detailed risk analysis.

### `fraud_alerts`
Contains alerts generated by the fraud detection system for specific transactions.
*   **Lookup Key:** `transaction_id`
*   **Key Fields:** `alert_id`, `severity`, `status`, `triggered_rules` (JSON string array), `estimated_fraud_probability`.

## Dimension & Reference Tables

### `users`
User profile and KYC information.
*   **Primary Key:** `user_id`
*   **Key Fields:** `username`, `email`, `kyc_status`, `risk_level`, `registration_date`.

### `accounts`
Financial account details.
*   **Primary Key:** `account_id`
*   **Foreign Key:** `user_id`
*   **Key Fields:** `account_type`, `balance_usd`, `daily_limit`, `frozen`.

### `merchants`
Merchant/business information and risk rating.
*   **Primary Key:** `merchant_id`
*   **Key Fields:** `business_name`, `country`, `license_status`, `risk_rating`, `sanctions_check`.

### `cards`
Payment card details.
*   **Primary Key:** `card_id`
*   **Foreign Key:** `user_id`
*   **Key Fields:** `card_type`, `issuer_country`, `status`, `velocity_flags` (JSON string array).

### `devices`
Device fingerprinting and connection data.
*   **Primary Key:** `device_id`
*   **Foreign Key:** `user_id`
*   **Key Fields:** `device_fingerprint`, `ip_address`, `vpn_detected`, `risk_score`.

### `locations`
Geographic reference data.
*   **Primary Key:** `location_id`
*   **Key Fields:** `city`, `country`, `latitude`, `longitude`.

### `risk_scores`
Historical risk scoring for users.
*   **Lookup Key:** `user_id`
*   **Key Fields:** `current_score`, `score_history` (JSON string array), `risk_factors` (JSON string array).

### `blacklist`
List of sanctioned or blocked entities (users, accounts, cards, devices, merchants).
*   **Schema Note:** Uses a generic schema.
    *   `entity_id`: Unique ID for the blacklist entry.
    *   `entity_type`: e.g., 'USER', 'ACCOUNT', 'MERCHANT'.
    *   `value`: The actual identifier (e.g., a `user_id`, `merchant_id`).
    *   `reason`, `severity`, `source`.
*   **Query Tip:** To find if any entity related to a transaction is blacklisted, search the `value` column for the relevant IDs (`user_id`, `account_id`, `merchant_id`, `card_id`, `device_id`).

## Query Patterns for Investigation

1.  **Get Transaction Core:**
    